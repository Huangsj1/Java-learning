网关也属于一个**微服务**，也需要进行nacos注册

网关的负载均衡是接收客户端的请求后，拉取Nacos的服务列表来进行负载均衡的，实际也是通过Ribbon进行的，和远程调用的负载均衡一样

![[dc1e07494caed27cf3e4c1df0d35e00.jpg]]

![[Pasted image 20240223110644.png]]

# 一、搭建服务

网关模块搭建

![[58576dc22ac333c353b094fd4516ee0.jpg]]![[278d0aca4d48ca54d0d996e06130d24.jpg]]

## 原理

![[Pasted image 20240223112025.png]]

![[Pasted image 20240223112203.png]]

# 二、路由断言工厂

通过在配置文件中路由配置的 `predicates` 中可以配置路由断言信息，这些字符串都会被路由断言工厂读取来处理，满足这些断言的请求才能由网关转发

![[Pasted image 20240223112655.png]]

![[b195817aabe88405bdaeb1a79baf9a1.jpg]]

# 三、路由过滤器

路由过滤器可以对进入网关的**请求**和微服务返回的**响应**进行处理

![[8accf24c39a71ccd6d9dc9c412d1af9.jpg]]

![[Pasted image 20240223113345.png]]

1、给**某个服务**添加过滤器——路由过滤器：

![[Pasted image 20240223113410.png]]

2、**默认**过滤器：

![[Pasted image 20240223113425.png]]

## 1. 全局过滤器 GlobalFilter

前面用到的过滤器都是由Spring提供的，处理逻辑都是固定的，如果需要**自己定义一个过滤器**就需要自定义类实现 `GlobalFilter` 接口并实现方法`filter()`

![[d31c03475485fed31571662292e9c44.jpg]]

实例：

![[7bf02802d6edba2e62eed43381a17fb.jpg]]

## 2. 过滤器执行顺序

三种过滤器：

* 路由过滤器（配置文件中指定某个服务的过滤器）
* 默认过滤器（配置文件中默认的过滤器）
* 全局过滤器（自定义的过滤器）

执行顺序：

1. order值越小，优先级越高
	1. 路由过滤器和默认过滤器分别从1开始按照声明顺序递增
	2. 全局过滤器可以通过order指定
2. 相同order顺序：默认过滤器 > 局部路由过滤器 > 全局过滤器

![[902fd528f0126a8dae9fcf342d70751.jpg]]![[a95002b4a7731811d8f6a481a9085a8.jpg]]

# 四、跨域问题处理

![[b5b149c8030dd2f5d2025c867643d01.jpg]]