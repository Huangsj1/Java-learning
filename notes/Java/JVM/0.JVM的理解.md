# 底层理解

![[5337bb3de0f33456dc0de2d533b3853.jpg]]

本质是一个运行在计算机上的程序，负责运行java字节码文件

1. 通过 `javac` 编译生成的 `.class` **字节码文件**，里面包含类的元信息（如类名、字段、方法及其代码等），不包括具体地址等与内存有关的信息
	* 字节码文件是二进制文件，可以通过反编译得到里面的内容
2. 当一个java程序通过 `java` 运行的时候，操作系统会**创建一个JVM进程**，其主线程进行JVM的各种初始化，包括向操作系统**申请一块内存空间提供给将来java程序使用**，并**对该内存空间进行划分**（堆、方法区、程序计数器、虚拟机栈、本地方法栈），之后就将 `.class` **字节码文件加载**到该空间的方法区中
	* JVM申请的空间是由JVM来管理的，所以能够实现跨平台
3. 之后通过使用**类加载器**将 `.class` **字节码文件加载**到该一个 `byte[]` 数组中，然后JVM就使用对应的方法根据字节码文件在方法区创建 `InstanceKlass` 对象存储字节码文件内容，并在堆中创建 `Class` 对象
4. 然后创建新的线程来**运行解释器**（解释器也属于JVM的一部分），解释器会读取方法区中的字节码文件进行**逐行解释成当前机器的机器代码**给CPU执行
	1. java程序对应的线程创建对象：在申请的内存空间中划分为堆的部分创建，这里会用到堆的地址
	2. 调用方法：在线程的栈中创建栈帧，放入参数、返回地址，然后线程的程序计数器指向对应方法的代码来执行
	3. 创建子线程：JVM会在申请的内存中划分出新的区域来存储这个线程所需要的程序计数器、Java 虚拟机栈和本地方法栈（不够则继续向操作系统申请）
	4. 一般不允许创建子进程，但可以创建系统进程，如打开记事本，但是创建的系统进程是一个独立于JVM的进程

---

* 优点：
	1. 一次编写，多处运行，跨平台
	2. 自动内存管理、垃圾回收功能
	3. 多态（通过方法表）
* 功能：
	1. 解释和运行
	2. 内存管理
	3. 即时编译（JIT）


![[Pasted image 20240308145056.png]]

![[Pasted image 20240308145107.png]]